<!DOCTYPE html>
<html lang="cs">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Nerealistické videoefekty &ndash; Jestřáblog</title>

    <!-- Meta -->
    <meta name="description" content="Jestřáblog &ndash; Život z ptačí perspektivy">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Social -->
    <meta property="article:author" content="Petr Nohejl" />
    <meta property="article:section" content="Informační technologie" />
    <meta property="article:published_time" content="2011-01-05" />

    <meta property="og:type" content="article"/>
    <meta property="og:title" content="Nerealistické videoefekty"/>
    <meta property="og:description" content="V tomto článku bych chtěl popsat projekt, na kterém jsem pracoval v zimním semestru 2010 spolu s Petrem Panáčkem. Projekt se zabývá nerealistickými videoefekty. Text článku je převzat z dokumentace projektu pro předmět PGP. Úvod Cílem práce bylo nastudovat metody používané v nerealistickém zobrazování videa. Hlavním úkolem pak bylo navrhnout …"/>
    <meta property="og:site_name" content="Jestřáblog" />
    <meta property="og:url" content="http://blog.petrnohejl.cz/nerealisticke-videoefekty"/>

    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Nerealistické videoefekty">
    <meta name="twitter:description" content="V tomto článku bych chtěl popsat projekt, na kterém jsem pracoval v zimním semestru 2010 spolu s Petrem Panáčkem. Projekt se zabývá nerealistickými videoefekty. Text článku je převzat z dokumentace projektu pro předmět PGP. Úvod Cílem práce bylo nastudovat metody používané v nerealistickém zobrazování videa. Hlavním úkolem pak bylo navrhnout …">
    <meta name="twitter:url" content="http://blog.petrnohejl.cz/nerealisticke-videoefekty">

    <!-- Feed -->
    <link rel="alternate" type="application/atom+xml" href="http://blog.petrnohejl.cz/feed.xml" title="Jestřáblog Atom Feed" />
    <link rel="alternate" type="application/rss+xml" href="http://petrnohejl.disqus.com/latest.rss" title="Jestřáblog Comments RSS Feed">

    <!-- CSS -->
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Open+Sans:regular,bold">
    <link rel="stylesheet" type="text/css" href="http://blog.petrnohejl.cz/theme/css/w3.css">
    <link rel="stylesheet" type="text/css" href="http://blog.petrnohejl.cz/theme/css/style.css">
    <link rel="stylesheet" type="text/css" href="http://blog.petrnohejl.cz/theme/css/jqcloud.css">
    <link rel="stylesheet" type="text/css" href="http://blog.petrnohejl.cz/theme/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="http://blog.petrnohejl.cz/theme/css/pygments-highlight-github.css">
    <link rel="stylesheet" type="text/css" href="http://blog.petrnohejl.cz/static/custom.css">

    <!-- Icon -->
    <link rel="shortcut icon" type="image/x-icon" href="http://blog.petrnohejl.cz/favicon.ico">

    <!-- JavaScript -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <script src="http://blog.petrnohejl.cz/theme/js/jqcloud.min.js"></script>
  </head>

  <body>
    <div class="w3-row w3-card w3-white">
      <header id="header">
        <a href="http://blog.petrnohejl.cz" id="header-logo" title="Home">PN</a>
        <nav id="header-menu">
          <ul>
            <li class="w3-bottombar w3-border-white w3-hover-border-green"><a href="/categories.html">Categories</a></li>
            <li class="w3-bottombar w3-border-white w3-hover-border-green"><a href="/archive.html">Archive</a></li>
          </ul>
        </nav>
      </header>
    </div>



    <br><br><br>

    <article>
      <header class="w3-container col-main">
        <h1>Nerealistické videoefekty</h1>
        <div class="post-info">
          <div class="w3-opacity w3-margin-right w3-margin-bottom" style="flex-grow: 1;">
            <span><time datetime="2011-01-05T00:00:00+01:00">05.01.2011</time> in <a href="http://blog.petrnohejl.cz/category/informacni-technologie" title="All articles in category Informační technologie">Informační technologie</a></span>
          </div>
        </div>
      </header>

      <br>


      <div class="col-main w3-container">
        <section id="content">
          <p>V tomto článku bych chtěl popsat projekt, na kterém jsem pracoval v
zimním semestru 2010 spolu s Petrem Panáčkem. Projekt se zabývá
nerealistickými videoefekty. Text článku je převzat z dokumentace
projektu pro předmět
<abbr title="Pokročilá počítačová grafika">PGP</abbr>.</p>
<h2 id="uvod">Úvod</h2>
<p>Cílem práce bylo nastudovat metody používané v nerealistickém
zobrazování videa. Hlavním úkolem pak bylo navrhnout a implementovat
aplikaci realizující vybraný efekt na videosekvenci a zhodnotit možnosti
metod pro zpracování videa (stabilita mezi framy, plynulost pohybů
apod.). Nakonec bylo úkolem demonstrovat dosažené výsledky na vhodných
vstupech a vyhodnotit.</p>
<p>V rámci projektu jsme implementovali aplikaci demonstrující 3
nerealistické video efekty:</p>
<ul>
<li>Komiksový efekt</li>
<li>Malířský efekt</li>
<li>Mozaikový efekt</li>
</ul>
<h2 id="nerealisticke-videoefekty">Nerealistické videoefekty</h2>
<p>Nerealistické renderování je oblast počítačové grafiky, která se
zaměřuje na různé metody expresivního vyjádření (vykreslení) digitálního
obrazu. Jedná se o opačný proces vykreslování realistické grafiky, tedy
soubor technik vedoucích k výstupu, který nemá charakter
fotorealistického grafického výstupu. Zpravidla se používá tehdy, kdy je
potřeba imitovat různé techniky výtvarného umění nebo zvýraznit některé
rysy zobrazovaného útvaru. Vstupem je videosekvence reálného obrazu,
pořízená videokamerou, 3D scéna nebo jiná videosekvence. Výstupem filtru
je vyrenderovaná videosekvence s daným nerealistickým efektem. [1]</p>
<p>Příklady některých nerealistických efektů:</p>
<ul>
<li>Komiks (cartoon, comic)</li>
<li>Malířské techniky (painterly rendering)</li>
<li>Náčrtky (sketching)</li>
<li>Deformace obrazu (liquify)</li>
</ul>
<h3 id="komiksovy-efekt">Komiksový efekt</h3>
<p>Komiksový efekt napodobuje kreslený film. Výsledkem je segmentovaný
obraz s redukovaným rozsahem barev a se zvýrazněnými hranami (obr. 1).</p>
<p>Algoritmus pro vykreslování efektu používá metodu shlukování, konkrétně
algoritmus K-means (viz kapitola Algoritmy pro zpracování efektů). Při
každém vykreslení snímku nejprve proběhne výpočet počtu shluků. To
zajišťuje lepší stabilitu obrazu mezi jednotlivými snímky. Počet shluků
se určuje z barevnosti snímku pomocí histogramu a mění se jen při
výraznější změně barevnosti.</p>
<p>Algoritmus K-means segmentuje pixely obrazu do shluků podle 5 kritérií:
červená barevná složka, zelená barevná složka, modrá barevná složka,
pozice na ose x, pozice na ose y. Barva jednotlivých shluků se vypočítá
z průměru barev všech pixelů daného segmentu.</p>
<p>Nakonec se v obraze zvýrazní hrany pomocí Cannyho algoritmu pro detekci
hran (viz kapitola Algoritmy pro zpracování efektů). Ten najde v obraze
hrany, rozšíří je pomocí dilatace o určitou velikost a odpovídající
pixely ve výsledném obraze potom ztmaví o danou hodnotu.</p>
<p><img alt="Obr. 1: Ukázka komiksového efektu" src="http://blog.petrnohejl.cz/images/nerealisticke-videoefekty-01.jpg"></p>
<h3 id="malirsky-efekt">Malířský efekt</h3>
<p>Malířský efekt imituje obraz malovaný štětcem na plátno. Výsledkem je
obraz složený z menších různobarevných oblastí, připomínající stopy
štětce (obr. 4).</p>
<p>Algoritmus zpracovává každý snímek videa v několika průchodech. V těchto
průchodech jsou do obrazu zakreslovány čáry o různých tloušťkách,
přičemž každá čára představuje jeden tah štětcem (obr. 3). Při
zpracování jednoho snímku je ze všeho nejdříve rozmazán původní obrázek.
V každém průchodu je poté obrázek překreslen jemnějším štětcem. Kromě
zmenšování tloušťky štětce je také v každém průchodu zvětšována hustota
zakreslovaných čar. Jinými slovy, je zmenšován krok průchodu obrazem.
Jemnější štětce jsou ovšem použity pouze v místech, kde se aktuální
obraz liší od původního rozmazaného obrazu. Díky tomu je zajištěna vyšší
stabilita mezi jednotlivými snímky. Překreslování tenčím štětcem tedy
slouží k odstranění nepřesností v aktuálním obraze. Po použití
jemnějšího štětce je obraz vždy znovu rozmazán. Rozmazání obrazu se
provádí pomocí algoritmu Gaussian blur (viz kapitola Algoritmy pro
zpracování efektů).</p>
<p>Směr kreslené čáry je určen kolmicí ke gradientu obrazu. Gradient je
vypočítán pomocí Sobelova filtru (viz kapitola Algoritmy pro zpracování
efektů) použitého ve směru osy x a y (obr. 2). Kolmice je poté získána
pouhým prohozením souřadných os a změnou znaménka jedné osy. Barva čáry
je vypočítána jako průměrná hodnota mezi počátečním a koncovým bodem
čáry, přičemž hodnota těchto bodů je brána z původního rozmazaného
obrazu. [2]</p>
<p><img alt="Obr. 2: Vykreslení čáry" src="http://blog.petrnohejl.cz/images/nerealisticke-videoefekty-02.jpg"></p>
<p><img alt="Obr. 3: Vykreslování čar v jednotlivých průchodech (postupně zleva doprava)" src="http://blog.petrnohejl.cz/images/nerealisticke-videoefekty-03.jpg"></p>
<p><img alt="Obr. 4: Ukázka malířského efektu" src="http://blog.petrnohejl.cz/images/nerealisticke-videoefekty-04.jpg"></p>
<h3 id="mozaikovy-efekt">Mozaikový efekt</h3>
<p>Mozaikový efekt je jednoduchý a často používaný. Obraz napodobuje
mozaiku. Používá se pro skrytí detailů v obraze. Výsledkem je obraz
složený z větších jednobarevných čtverců (obr. 5).</p>
<p>Algoritmus rozděluje obraz na čtvercové oblasti o určité velikosti. Tyto
oblasti jsou potom obarveny jednou barvou, vypočtenou z průměru barev
všech pixelů původní oblasti.</p>
<p><img alt="Obr. 5: Ukázka efektu mozaiky" src="http://blog.petrnohejl.cz/images/nerealisticke-videoefekty-05.jpg"></p>
<h2 id="algoritmy-pro-zpracovani-efektu">Algoritmy pro zpracování efektů</h2>
<h3 id="k-means">K-means</h3>
<p>Algoritmus K-means slouží k segmentaci obrazu. Obraz se skládá z <em>K</em>
regionů a každý pixel je klasifikován do jednoho z regionu. Každý region
je reprezentován středem μi. Pixel je klasifikován do regionu, jehož
střed je nejblíže (obr. 6).</p>
<p><img alt="Obr. 6: Ukázka segmentace podle K-means ve 2D (kříže znázorňují středy regionů μi)" src="http://blog.petrnohejl.cz/images/nerealisticke-videoefekty-06.jpg"></p>
<p>Algoritmus K-means:</p>
<ol>
<li>Náhodně inicializuj středy regionů μi.</li>
<li>Klasifikuj pixely xn do regionů.</li>
<li>Vypočti nové středy regionů.</li>
<li>Opakuj kroky 2 a 3, dokud se středy shluků mění.</li>
</ol>
<h3 id="cannyho-hranovy-detektor-a-sobeluv-operator">Cannyho hranový detektor a Sobelův operátor</h3>
<p>Cannyho hranový detektor je algoritmus, který nalezne množinu hran
v obraze. Využívá Sobelův operátor ve směru <em>X</em> a <em>Y</em>, potlačení
nemaximálních hodnot a prahování s hysterezí. Zvýraznění hran pomocí
Cannyho algoritmu je vidět například v obr. 1.</p>
<p>Sobelův operátor je diskrétní diferenciální operátor, který počítá
aproximaci gradientu intenzity obrazu. Je založen na konvoluci obrazu
pomocí filtru v horizontálním a vertikálním směru. Zpravidla používá
konvoluční matice o velikosti 3x3 (vzorec 1).</p>
<p><img alt="Vzorec 1: Konvoluční matice Sobelova filtru (A je zdrojový obraz, G je výsledný gradient)" src="http://blog.petrnohejl.cz/images/nerealisticke-videoefekty-07.jpg"></p>
<p>Potlačení nemaximálních hodnot (Non-maximum suppression) funguje tak, že
ve směru gradientu se potlačí pixely, které nejsou lokálním maximem
(obr. 7). Výsledkem je ztenčení tlustých hran potlačením nemaximálních
hodnot v černobílém obraze.</p>
<p><img alt="Obr. 7: Znázornění pixelů ve směru gradientu" src="http://blog.petrnohejl.cz/images/nerealisticke-videoefekty-08.jpg"></p>
<p>Prahování s histerezí funguje tak, že silné hrany (větší než <em>High</em>)
jsou ponechány. Slabé jsou ponechány, pouze pokud jsou spojeny s nějakou
silnější hranou (obr. 8). Velmi slabé hrany jsou potlačeny (nižší než
<em>Low</em>). Obvykle platí: <em>High</em> = 2-3 * <em>Low</em>.</p>
<p><img alt="Obr. 8: Prahování s histerezí" src="http://blog.petrnohejl.cz/images/nerealisticke-videoefekty-09.jpg"></p>
<h3 id="gaussian-blur">Gaussian blur</h3>
<p>Gaussian blur je často používaný algoritmus v počítačové grafice pro
redukci šumu a detailů. Funguje na principu konvoluce pomocí Gaussovské
funkce (vzorec 2). Gaussian blur je filtr s dolní propustí.</p>
<p><img alt="Vzorec 2: Dvou dimenzionální Gaussovská funkce" src="http://blog.petrnohejl.cz/images/nerealisticke-videoefekty-10.jpg"></p>
<h2 id="implementace-aplikace">Implementace aplikace</h2>
<p>Aplikace demonstruje 3 video efekty: komiksový efekt, mozaikový efekt a
malířský efekt. Vstupem programu je typ efektu a název video souboru ve
formátu AVI. Výstupem jsou dvě okna, zobrazující video. První ukazuje
originální obraz, druhé zobrazuje vyrenderovaný obraz, na který byl
aplikován daný efekt.</p>
<p>Program demonstrující výše zmíněné nerealistické efekty je implementován
v jazyce C/C++, v prostředí Visual Studio 2008. Používá knihovnu OpenCV.
Pro úspěšné sestavení projektu je nutné mít nainstalovanou tuto knihovnu
a správně definovány v nastavení projektu knihovny pro linker.</p>
<p>Každý efekt je implementován ve vlastní třídě (<em>effectComic</em>,
<em>effectPainterly</em>, <em>effectMosaic</em>). Na začátku každého zdrojového
souboru s efektem jsou definovány konstanty, ovlivňující různé
vlastnosti při výpočtu efektu. Konstanty lze měnit a ovlivňovat tak
některé parametry efektu. Třída <em>effects</em> se stará o základní zpracování
obrazu - načtení videa ze souboru a zobrazení na výstup.</p>
<p>Ovládání aplikace:</p>
<ul>
<li><em>VideoEffects.exe -h</em> - zobrazí nápovědu</li>
<li><em>VideoEffects.exe -c inputVideo</em> - demonstruje komiksový efekt</li>
<li><em>VideoEffects.exe -p inputVideo</em> - demonstruje malířský efekt</li>
<li><em>VideoEffects.exe -m inputVideo</em> - demonstruje mozaikový efekt</li>
</ul>
<p><em>inputVideo</em> je název vstupního video souboru ve formátu AVI.</p>
<h2 id="zaver">Závěr</h2>
<p>Nerealistické vykreslování obrazu může mít různé využití. Používá se
například v moderních videokamerách pro „umělecké“ efekty, mobilních
telefonech s fotoaparátem nebo také v programech pro střihání videa.
Využití může nalézt i v zábavném průmyslu, např. v počítačových hrách
nebo aplikacích na webu.</p>
<p>Díky projektu jsme se naučili metody a principy pro nerealistické
renderování obrazu. Naučili jsme se nové algoritmy pro zpracování obrazu
a prohloubili si znalosti v programování aplikací v OpenCV.</p>
<p>Zdrojové soubory projektu na <a href="https://github.com/petrnohejl/Non-Realistic-Video-Effects">github.com</a>.</p>
<h2 id="zdroje">Zdroje</h2>
<p>[1] Non-photorealistic rendering. In Wikipedia : the free encyclopedia
[online]. St. Petersburg (Florida) : Wikipedia Foundation, 9.1.2005,
last modified on 14.10.2010 [cit. 2010-12-28]. Dostupné z WWW:
http://en.wikipedia.org/wiki/Non-photorealistic_rendering.</p>
<p>[2] HERTZMANN, Aaron; PERLIN, Ken. Painterly rendering : Painterly
Rendering with Curved Brush Strokes of Multiple Sizes [online]. New
York University, Media Research Laboratory : 2000 [cit. 2010-12-29].
Dostupné z WWW: http://mrl.nyu.edu/projects/npr/painterly/.</p>
<p>[3] Matlab Central [online]. 27.3.2008 [cit. 2010-12-29]. Efficient
K-Means Clustering. Dostupné z WWW:
http://www.mathworks.com/matlabcentral/fileexchange/19344-efficient-k-means-clustering-using-jit.</p>
<p>[4] Sobel operator. In Wikipedia : the free encyclopedia [online]. St.
Petersburg (Florida) : Wikipedia Foundation, 19.2.2004, last modified on
12.12.2010 [cit. 2010-12-29]. Dostupné z WWW:
http://en.wikipedia.org/wiki/Sobel_operator.</p>
        </section>

        <br><br><br>

        <footer>
          <div class="adjust-width">
            <div id="author-block" class="w3-light-grey w3-border">
              <div id="author-info">
                <a href="http://petrnohejl.cz"><img style="width: 60px; height: 60px;" src="http://www.gravatar.com/avatar/8fafd9d1a430a1e843478f00c3da924a?s=240" onerror="this.src='theme/images/avatar.png'" alt="Avatar"></a>
                <div style="margin-left: 20px; margin-top: 15px;">
                  <a href="http://petrnohejl.cz"><span id="author-name" class="w3-hover-text-dark-grey">Petr Nohejl</span></a>
                  <p id="author-story">Hi! I’m Petr – an Android engineer living in Brno, Czech Republic. I’m passionate about code, software architecture and technology. I studied at the Brno University of Technology and currently I work at STRV as team lead of the Android department. I’ve been developing mobile apps since 2009. I like #android #coffee #reggae #photography #djembe #asianculture #valueinvesting #myfamily.</p>
                </div>
              </div>
            </div>
          </div>

          <br><br><br>

          <p style="font-size:10pt; font-style: italic;">Did you like this article? Share it with your friends!</p>
          <div id="share" class="share">
            <a href="http://www.facebook.com/sharer.php?u=http%3A//blog.petrnohejl.cz/nerealisticke-videoefekty&amp;t=Jest%C5%99%C3%A1blog%3A%20Nerealistick%C3%A9%20videoefekty" target="_blank" class="w3-btn w3-indigo">
              <i class="fa fa-facebook"></i> <span>Facebook</span>
            </a>
            <a href="http://twitter.com/share?url=http%3A//blog.petrnohejl.cz/nerealisticke-videoefekty&amp;text=Jest%C5%99%C3%A1blog%3A%20Nerealistick%C3%A9%20videoefekty" target="_blank" class="w3-btn w3-blue">
              <i class="fa fa-twitter"></i> <span>Twitter</span>
            </a>
            <a href="https://plus.google.com/share?url=http%3A//blog.petrnohejl.cz/nerealisticke-videoefekty" onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" class="w3-btn w3-red">
              <i class="fa fa-google-plus"></i> <span>Google</span>
            </a>
          </div>

          <br><br><br>


          <div id="disqus_thread"></div>
          <script>
            /**
             *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
             *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
             */
            
            var disqus_config = function () {
              this.page.url = 'http://blog.petrnohejl.cz';  // Replace PAGE_URL with your page's canonical URL variable
              this.page.identifier = 'nerealisticke-videoefekty'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
            };
            
            (function() {  // REQUIRED CONFIGURATION VARIABLE: EDIT THE SHORTNAME BELOW
              var d = document, s = d.createElement('script');
              
              s.src = 'https://petrnohejl.disqus.com/embed.js';  // IMPORTANT: Replace EXAMPLE with your forum shortname!
              
              s.setAttribute('data-timestamp', +new Date());
              (d.head || d.body).appendChild(s);
            })();
          </script>
          <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
          <br><br><br>

        </footer>
      </div>
    </article>


    <footer id="footer">
      <div id="footer-copyright" class="w3-center w3-small w3-text-grey w3-padding-48">
        <span>&copy; 2009-2017 Petr Nohejl  | <a href="http://blog.petrnohejl.cz/feed.xml">Atom feed <i class="fa fa-rss" aria-hidden="true"></i></a></span>
      </div>
    </footer>

    <!-- Google Analytics -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-17930136-2', 'auto');
      ga('send', 'pageview');
    </script>

  </body>
</html>